{# rootForm var is provided by root form template which calls this template #}
{% set formName = rootForm.vars.name %}
{# Get "prototype_name" option value from images Collection #}
{% set imageIndex = createTrickForm.images.vars.prototype.vars.name %}
<div id="{{ formName }}_images_{{ imageIndex }}" class="uk-position-relative uk-border-rounded uk-padding-small uk-margin-small-bottom st-image-to-crop st-background-blue st-box-shadow-full-small">
    {# Image block removal #}
    <a href="#" class="uk-position-top-right uk-button uk-box-shadow-medium uk-box-shadow-hover-large uk-padding-remove uk-margin-small-top uk-margin-small-right st-image-remove-button" title="Cancel">
        <span uk-icon="icon: close; ratio: 1" class="uk-icon st-color-white st-background-black st-svg-icon-button st-svg-icon-delete st-svg-icon-actions"></span>
    </a>
    {# form label for imageToCrop form entry type #}
    {{ form_label(rootForm.images.vars.prototype, 'Image NÂ° '~imageIndex, {
        'label_attr': {
            'class': 'uk-form-label uk-text-uppercase st-image-to-crop-label',
            'data-image-index-name': imageIndex
        }
    }) }}
    {# Image fields #}
    <div class="uk-grid uk-grid-collapse">
        {# Image file #}
        <div class="uk-width-1-1 uk-margin-small-bottom">
            {{ form_label(rootForm.images.vars.prototype.image, 'Image file', {'label_attr': {'class': 'uk-form-label'}}) }}
            <div class="uk-inline uk-flex uk-flex-middle">
                <div class="uk-flex-column uk-position-relative uk-box-shadow-small uk-border-rounded uk-padding-small uk-margin-small-right st-background-white">
                    {# TODO: change calls to variables! #}
                    {# Image preview #}
                    <img id="st-image-preview-{{ imageIndex }}" class="st-image-preview" width="142" src="{{ asset(globalImageDirectory~'image-crop-box-default-thumb.png') }}" alt="Image description must be filled in!" >
                    {{ form_row(rootForm.images.vars.prototype.imagePreviewDataURI, {
                        'attr': {'class': 'st-image-preview-data-uri'},
                        'value': rootForm.images.vars.prototype.imagePreviewDataURI.vars.value
                        })
                    }}
                </div>
                <div id="st-add-image-actions-{{ imageIndex }}" class="uk-flex-column">
                    <div id="st-add-image-container-{{ imageIndex }}" data-change-text-info="Please confirm image change by validating creation!" uk-form-custom>
                        {# Image file input #}
                        <div class="uk-inline">
                            {{ form_widget(rootForm.images.vars.prototype.image, {
                                'attr': {
                                    'class': 'uk-input st-file-input',
                                    'data-error': 'Please select first<br>an image file which is allowed!'
                                },
                                'value': rootForm.images.vars.prototype.image.vars.value})
                            }}
                            {# image change button #}
                            <button class="uk-button uk-button-default st-fake-file-input-button" type="button" tabindex="-1">
                                <span class="uk-form-icon" uk-icon="icon: upload"></span>
                                <span id="st-image-change-button-label-{{ imageIndex }}" class="uk-padding-small" data-select-label="Select" data-change-label="Change">Select</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {# ------------------------------------------------------------------------------------------------------------------------------------------------------ #}
            {# Image description #}
            <div class="uk-width-1-1 uk-margin-small-top">
                {{ form_label(rootForm.images.vars.prototype.description, 'Image description ("alt" html attribute)', {'label_attr': {'class': 'uk-form-label'}}) }}
                <div class="uk-inline uk-flex">
                    <span class="uk-form-icon st-textarea-icon" uk-icon="icon: code"></span>
                    {{ form_widget(rootForm.images.vars.prototype.description, {
                        'attr': {'class': 'uk-input'},
                        'value': rootForm.images.vars.prototype.description.vars.value})
                    }}
                </div>
            </div>
            {# ------------------------------------------------------------------------------------------------------------------------------------------------------ #}
            {# Image crop modal: opened when image file input changes #}
            <div id="st-cropper-modal-{{ imageIndex }}" class="uk-flex-top" uk-modal="esc-close: false; bg-close: false">
                <div class="uk-modal-dialog uk-modal-body uk-margin-auto-vertical">
                    <button class="uk-modal-close-outside" type="button" uk-close></button>
                    <h3 class="uk-modal-title uk-text-lead uk-text-center uk-text-bold uk-text-uppercase st-color-black">Resize your image</h3>
                    <p class="uk-flex uk-flex-center uk-flex-column">
                    <ul class="uk-list uk-text-small">
                        <li><span class="uk-icon st-color-blue" uk-icon="icon: move"></span> Allowed format: <strong>16/9 selection</strong></li>
                        <li><span class="uk-icon st-color-blue" uk-icon="icon: image"></span> Exported dimensions: <strong>width: 1600px</strong> X <strong>height: 900px</strong></li>
                    </ul>
                    </p>
                    <div id="st-cropper-container-{{ imageIndex }}" class="uk-flex uk-flex-center uk-border-rounded uk-margin-auto st-cropper-container st-box-shadow-full-small">
                        <div id="st-cropper-container-content-{{ imageIndex }}" class="uk-responsive uk-margin-top uk-margin-right uk-margin-bottom uk-margin-left st-cropper-container-content">
                            <img id="st-cropper-preview-{{ imageIndex }}" class="uk-responsive st-cropper-preview" src="" alt="Crop preview">
                        </div>
                    </div>
                    <div class="uk-flex uk-flex-center uk-margin-top">
                        <button id="st-crop-button-{{ imageIndex }}" class="uk-button uk-button-secondary uk-border-rounded uk-box-shadow-hover-medium uk-text-bold st-crop-button" title="Validate">
                            Crop <span uk-icon="icon: chevron-right; ratio: 1.3"></span>
                        </button>
                    </div>
                    <p class="uk-margin-small-top"><small>Validate crop by clicking on button or closing window.</small></p>
                </div>
            </div>
            {# ------------------------------------------------------------------------------------------------------------------------------------------------------ #}
            {# Image crop JSON data #}
            <div id="st-crop-data-{{ imageIndex }}">
                {# Hidden field used to store crop data after crop action #}
                {{ form_row(rootForm.images.vars.prototype.cropJSONData, {
                    'attr': {'class': 'st-crop-data'},
                    'value': rootForm.images.vars.prototype.cropJSONData.vars.value})
                }}
            </div>
            {# ------------------------------------------------------------------------------------------------------------------------------------------------------ #}
            {# Saved image name (must correspond to a standalone uploaded image) #}
            <div id="st-save-image-name-{{ imageIndex }}">
                {# Hidden field used to store saved uploaded image during validation:
                    Please note this field is used because non persistence of image file,
                    so we upload the temporary file (on server) as a standalone media in a kind of global image gallery,
                    to keep in memory the last uploaded file until root form entire validation! #}
                {{ form_row(rootForm.images.vars.prototype.savedImageName, {
                    'attr': {'class': 'st-saved-image-name'},
                    'value': rootForm.images.vars.prototype.savedImageName.vars.value})
                }}
            </div>
            {# ------------------------------------------------------------------------------------------------------------------------------------------------------ #}
            {# Show as main image? #}
            <div class="uk-width-1-1 uk-margin-small-top uk-margin-small-bottom">
                <div class="uk-inline">
                    {{ form_widget(rootForm.images.vars.prototype.isMain, {
                        'attr': {'class': 'uk-checkbox'},
                        'value': rootForm.images.vars.prototype.isMain.vars.value})
                    }}
                    {{ form_label(rootForm.images.vars.prototype.isMain, 'Show as main image?', {'label_attr': {'class': 'uk-form-label'}}) }}
                </div>
                <p class="uk-margin-small-top">
                    <small>
                        "Main image" option will promote this image on trick header page.
                    </small>
                </p>
            </div>
            {# ------------------------------------------------------------------------------------------------------------------------------------------------------ #}
        </div>
    </div>
</div>
